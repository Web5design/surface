<html>
<head>
  <title>Substance &middot; Surface</title>

  <link href='http://fonts.googleapis.com/css?family=Merriweather:400,700,300,900' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="stylesheets/surface.css">

  <script type="text/javascript" src="lib/underscore.js"></script>
  <script type="text/javascript" src="lib/jquery-min.js"></script>
  <script type="text/javascript" src="lib/keymaster.js"></script>
  <script type="text/javascript" src="surface.js"></script>

  <script type="text/plain" name="content">Substance provides a flexible architecture, involving an extensible document format and protocol, realtime synchronization, an extensible document composer as well as a reference implementation.</script>
  <style type="text/css">
  #content span{
    background-color: #dff;
    margin-right: 1px;
    line-height:34px;
    padding: 5px;
  }

.content hr{
  padding: 0;
  margin: 0;
  border-style: none;
  height: 18px;
}


  </style>
  <script>
    $(function() {
      window.surface = new Substance.Surface({
        el: $('.content')[0],
        content: $('script[name=content]').text(),
        annotations: {
          "annotation-1" : { id: "annotation-1", type: "str", pos: [0,9] },
          "annotation-2" : { id: "annotation-2", type: "em", pos: [57,10] },
          "annotation-3" : { id: "annotation-3", type: "comment", pos: [30,12] }
          // { id: "annotation-3", type: "comment", pos: [17,3] }
        },
        types: {
           "em": {
              "inclusive": false
           },
           "comment": {
              "inclusive": false
           }
        }
      });

      surface.on('content:changed', function(content, prevContent) {
        console.log('updated text from', prevContent, 'to: ', content);
      });

      // Update comments panel according to marker context
      surface.on('selection:changed', function(sel) {
        var marker = surface.getAnnotations(sel, ["comment"])[0];
        if (marker) {
          surface.highlight(marker.id);
        } else {
          surface.highlight(null);
        }
      });

      function log(message) {
        $('.debug-console').append($('<div class="log-entry">'+message+'</div>'))
      }

      $('a.show-selection').click(function(sel) {
        log("SELECTION: "+ surface.selection());
      });

      $('a.get-content').click(function(sel) {
        log("CONTENT: <br/><pre>"+ surface.getContent()+"</pre>");
      });

      $('a.set-selection').click(function(sel) {
        surface.select(17);
        // surface.deleteRange([0, 3]);
      });

      $('a.delete-selection').click(function(sel) {
        surface.deleteRange([0, 3]);
      });

      $('a.insert-annotation').click(function(sel) {
        surface.insertAnnotation({ id: "annotation-4", type: "comment", pos: [65,10] });
        surface.insertAnnotation({ id: "annotation-5", type: "marker", pos: [74,3] });
      });

      key('ctrl+m', function() {
        surface.insertAnnotation({ id: "annotation-5", type: "marker", pos: surface.selection() });
        return false;
      });

      key('ctrl+x', function() {
        var pos = surface.selection();
        var matching = surface.getAnnotations(pos[0]);
        surface.deleteAnnotation(matching[0]);
        return false;
      });

    });
  </script>

</head>
<body>
  <div id="content" class="content" spellcheck="false" contenteditable="true"></div>

<!--  <div class="debug">
    <h1>Actions</h1>
    <div class="actions">
       <a href="#" class="show-selection">Get Selection</a>
      <a href="#" class="get-content">Get Content</a>
      <a href="#" class="set-selection">Set selection</a>
      <a href="#" class="delete-selection">Delete Range [0..3]</a> 
      <a href="#" class="insert-annotation">Insert Annotation & Marker</a>
    </div>
    <div class="debug-console">
    </div>-->
  </div>
</body>
